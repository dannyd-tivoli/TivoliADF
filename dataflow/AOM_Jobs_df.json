{
	"name": "AOM_Jobs_df",
	"properties": {
		"folder": {
			"name": "Tivoli Data Warehouse"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "TivoliAPI_db",
						"type": "DatasetReference"
					},
					"name": "topsjobs"
				},
				{
					"dataset": {
						"referenceName": "TivoliAPI_db",
						"type": "DatasetReference"
					},
					"name": "Groups"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "FactTops",
						"type": "DatasetReference"
					},
					"name": "FactSync"
				},
				{
					"dataset": {
						"referenceName": "AOMGroup",
						"type": "DatasetReference"
					},
					"name": "DimAOMGroup"
				}
			],
			"transformations": [
				{
					"name": "DerivedColumns"
				},
				{
					"name": "Staging"
				},
				{
					"name": "AlterRowSettings"
				},
				{
					"name": "SelectFields"
				},
				{
					"name": "AlterRow1"
				}
			],
			"scriptLines": [
				"parameters{",
				"     LastRunDate as string (\"2022-05-09 00:00:00\")",
				"}",
				"source(output(",
				"          ID as integer,",
				"          AOMGroupID as integer,",
				"          DateAddedID as integer,",
				"          TimeAddedID as integer,",
				"          LastModifiedDateID as integer,",
				"          LastModifiedTimeID as integer,",
				"          JobID as integer,",
				"          Title as string,",
				"          Reference as string,",
				"          DateCreatedID as integer,",
				"          TimeCreatedID as integer,",
				"          DateModifiedID as integer,",
				"          TimeModifiedID as integer,",
				"          DispatchDateID as integer,",
				"          DueDateID as integer,",
				"          CurrentStatus as string,",
				"          CompletedBy as string,",
				"          IsCompleted as boolean,",
				"          DateCompletedID as integer,",
				"          TimeCompletedID as integer,",
				"          Address as string,",
				"          Latitude as string,",
				"          Longitude as string,",
				"          ManagerName as string,",
				"          SupervisorName as string,",
				"          TeamLeaderName as string,",
				"          ApprovalStatus as string,",
				"          ApprovalDateID as integer,",
				"          ApprovalTimeID as integer,",
				"          ApprovedBy as string,",
				"          ApprovalComments as string,",
				"          TemplateName as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     inputs:['@LastModifedDate' -> ($LastRunDate)],",
				"     procedureName: 'sp_tops_jobs_DW',",
				"     schemaName: 'dbo',",
				"     resultSet: true,",
				"     format: 'procedure') ~> topsjobs",
				"source(output(",
				"          ID as integer,",
				"          GroupReference as string,",
				"          GroupCode as string,",
				"          GroupName as string,",
				"          Deleted as boolean",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT [ID]\\n      ,[GroupReference]\\n      ,[GroupCode]\\n      ,[GroupName]\\n      ,[Deleted]\\n  FROM [AOM].[tbl_AOM_Groups]',",
				"     format: 'query') ~> Groups",
				"topsjobs derive(LastModifiedDateTime = currentUTC('GMT')) ~> DerivedColumns",
				"DerivedColumns select(mapColumn(",
				"          ID,",
				"          AOMGroupID,",
				"          DateAddedID,",
				"          TimeAddedID,",
				"          LastModifiedDateID,",
				"          LastModifiedTimeID,",
				"          JobID,",
				"          Title,",
				"          Reference,",
				"          DateCreatedID,",
				"          TimeCreatedID,",
				"          DateModifiedID,",
				"          TimeModifiedID,",
				"          DispatchDateID,",
				"          DueDateID,",
				"          CurrentStatus,",
				"          CompletedBy,",
				"          IsCompleted,",
				"          DateCompletedID,",
				"          TimeCompletedID,",
				"          Address,",
				"          Latitude,",
				"          Longitude,",
				"          ManagerName,",
				"          SupervisorName,",
				"          TeamLeaderName,",
				"          ApprovalStatus,",
				"          ApprovalDateID,",
				"          ApprovalTimeID,",
				"          ApprovedBy,",
				"          ApprovalComments,",
				"          TemplateName,",
				"          LastModifiedDateTime",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> Staging",
				"Staging alterRow(upsertIf(true())) ~> AlterRowSettings",
				"Groups select(mapColumn(",
				"          ID,",
				"          GroupReference,",
				"          GroupCode,",
				"          GroupName,",
				"          Deleted",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SelectFields",
				"SelectFields alterRow(upsertIf(true())) ~> AlterRow1",
				"AlterRowSettings sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          ID as integer,",
				"          AOMGroupID as integer,",
				"          DateAddedID as integer,",
				"          TimeAddedID as integer,",
				"          LastModifiedDateID as integer,",
				"          LastModifiedTimeID as integer,",
				"          JobID as integer,",
				"          Title as string,",
				"          Reference as string,",
				"          DateCreatedID as integer,",
				"          TimeCreatedID as integer,",
				"          DateModifiedID as integer,",
				"          TimeModifiedID as integer,",
				"          DispatchDateID as integer,",
				"          DueDateID as integer,",
				"          CurrentStatus as string,",
				"          CompletedBy as string,",
				"          IsCompleted as boolean,",
				"          DateCompletedID as integer,",
				"          TimeCompletedID as integer,",
				"          Address as string,",
				"          Latitude as string,",
				"          Longitude as string,",
				"          ManagerName as string,",
				"          SupervisorName as string,",
				"          TeamLeaderName as string,",
				"          ApprovalStatus as string,",
				"          ApprovalDateID as integer,",
				"          ApprovalTimeID as integer,",
				"          ApprovedBy as string,",
				"          ApprovalComments as string,",
				"          TemplateName as string,",
				"          LastModifiedDateTime as timestamp",
				"     ),",
				"     deletable:false,",
				"     insertable:false,",
				"     updateable:false,",
				"     upsertable:true,",
				"     keys:['ID'],",
				"     format: 'table',",
				"     batchSize: 10000,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          ID,",
				"          AOMGroupID,",
				"          DateAddedID,",
				"          TimeAddedID,",
				"          LastModifiedDateID,",
				"          LastModifiedTimeID,",
				"          JobID,",
				"          Title,",
				"          Reference,",
				"          DateCreatedID,",
				"          TimeCreatedID,",
				"          DateModifiedID,",
				"          TimeModifiedID,",
				"          DispatchDateID,",
				"          DueDateID,",
				"          CurrentStatus,",
				"          CompletedBy,",
				"          IsCompleted,",
				"          DateCompletedID,",
				"          TimeCompletedID,",
				"          Address,",
				"          Latitude,",
				"          Longitude,",
				"          ManagerName,",
				"          SupervisorName,",
				"          TeamLeaderName,",
				"          ApprovalStatus,",
				"          ApprovalDateID,",
				"          ApprovalTimeID,",
				"          ApprovedBy,",
				"          ApprovalComments,",
				"          TemplateName,",
				"          LastModifiedDateTime",
				"     )) ~> FactSync",
				"AlterRow1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          ID as integer,",
				"          GroupReference as string,",
				"          GroupCode as string,",
				"          GroupName as string,",
				"          Deleted as boolean",
				"     ),",
				"     deletable:false,",
				"     insertable:false,",
				"     updateable:false,",
				"     upsertable:true,",
				"     keys:['ID'],",
				"     format: 'table',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          ID,",
				"          GroupReference,",
				"          GroupCode,",
				"          GroupName,",
				"          Deleted",
				"     )) ~> DimAOMGroup"
			]
		}
	}
}